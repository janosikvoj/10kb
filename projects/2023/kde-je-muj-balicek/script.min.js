let t=0,e=1;const n=JSON.parse(localStorage.getItem("giftsPerLevel"))??[0,11,9,7,5,3,1];let o=document.getElementById("start-button"),l=document.getElementById("game-text"),s=document.querySelectorAll(".reload_button img");const c=document.querySelectorAll(".grid-container .cell");function i(){c.forEach((t=>{t.removeEventListener("click",g)}))}function a(){c.forEach((t=>{t.addEventListener("click",g)}))}function d(){t=0,e=1,a(),r(),document.getElementById("current-level").textContent=e,p()}function r(){document.querySelectorAll(".score").forEach((e=>{e.textContent=t.toString().padStart(4,0)}))}function m(){const t=["#FFE76B","#E7B5FF","#B7F479","#97F1D6"];return t[Math.floor(Math.random()*t.length)]}function u(){0===document.querySelectorAll('.gift:not([style*="display: block"])').length&&h()}function g(e){const n=e.target.classList.contains("cell")?e.target:e.target.closest(".cell");if(!n)return;const o=n.querySelector(".gift");o&&"none"===o.style.display?(t+=100,o.style.display="block",n.classList.add("gift-found"),n.style.backgroundColor=m(),u()):n.classList.contains("gift-found")||(t=Math.max(t-20,0),n.classList.add("empty"),n.classList.add("transition"),setTimeout((()=>{n.classList.remove("empty"),n.classList.remove("transition")}),500)),r()}function f(){const t=n[e],o=Array.from(document.querySelectorAll(".grid-container .cell:not(.gift-placed)"));let l=0;for(;l<t;){const t=o[Math.floor(Math.random()*o.length)];if(!t.classList.contains("gift-placed")){const e=y(t),n=document.createElement("div");n.className=`gift ${e}`,n.style.display="none",t.appendChild(n),t.classList.add("gift-placed"),l++}}}function y(t){return t.classList.contains("block-2x3")?"gift-2x3":t.classList.contains("block-2x2")?"gift-2x2":t.classList.contains("block-1x2")?"gift-1x2":t.classList.contains("block-2x1")?"gift-2x1":"gift-1x1"}function p(){E(),f(),L()}function E(){c.forEach((t=>{t.classList.remove("gift-placed","wrong","gift-found"),t.style.backgroundColor="";const e=t.querySelector(".gift");e&&e.remove()}))}function h(){i(),setTimeout((()=>{e<n.length-1?(e++,p(),a()):t===n.reduce(((t,e)=>t+100*e),0)?(E(),document.getElementById("finish-game-top").style.display=""):t>0?(E(),document.getElementById("finish-game-win").style.display=""):(E(),document.getElementById("finish-game-lose").style.display="")}),1e3)}function L(){document.getElementById("current-level").textContent=e,document.getElementById("gifts-count").textContent=n[e]}function B(){E(),i(),t=0,e=1,r(),L(),document.getElementById("start-screen").style.display="",document.getElementById("finish-game-lose").style.display="none",document.getElementById("finish-game-win").style.display="none",document.getElementById("finish-game-top").style.display="none"}s.forEach((t=>{t.addEventListener("click",B)})),o.addEventListener("click",(t=>{t.stopPropagation(),document.getElementById("start-screen").style.display="none",d()}));